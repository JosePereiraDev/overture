<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.overturetool.core</groupId>
    <artifactId>testing</artifactId>
    <version>2.1.3-SNAPSHOT</version>
    <relativePath>../pom.xml</relativePath>
  </parent>

  <groupId>org.overturetool.core.testing</groupId>
  <artifactId>framework</artifactId>
  <name>Overture Testing Framework</name>

  <dependencies>
    <dependency>
      <groupId>org.overturetool.core</groupId>
      <artifactId>ast</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.overturetool.core</groupId>
      <artifactId>parser</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.overturetool.core</groupId>
      <artifactId>typechecker</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
    </dependency>
    <dependency>
      <groupId>commons-io</groupId>
      <artifactId>commons-io</artifactId>
      <version>2.4</version>
    </dependency>
    <dependency>
      <groupId>org.apache.commons</groupId>
      <artifactId>commons-collections4</artifactId>
      <version>4.0</version>
    </dependency>
    <dependency>
      <groupId>com.google.code.gson</groupId>
      <artifactId>gson</artifactId>
      <version>2.2.4</version>
    </dependency>
  </dependencies>

  <build>
    <resources>
      <resource>
        <directory>${project.basedir}/../../../documentation/examples/</directory>
        <targetPath>${project.build.directory}/classes/examples/</targetPath>
        <includes>
          <include>**/*.vdmsl</include>
          <include>**/*.vdmpp</include>
          <include>**/*.vdmrt</include>
          <include>**/README.txt</include>
        </includes>
        <excludes>
          <exclude>target/**</exclude>
        </excludes>
      </resource>
    </resources>

    <plugins>
      <plugin>
        <!-- The purpose of this is to generate a couple of index
             files for the vdm examples and libs that get packed into
             this jarfile. -jwc/05Aug2014
             -->
        <artifactId>maven-antrun-plugin</artifactId>
        <executions>
          <execution>
            <phase>process-resources</phase>
            <goals>
              <goal>run</goal>
            </goals>
            <configuration>
                <target>
                    <fileset id="vdm-lib-sl-set" dir="${project.build.directory}/classes/examples/libs/SL" />
                    <pathconvert pathsep="${line.separator}" property="vdm-libs-sl" refid="vdm-lib-sl-set">
                        <map from="${project.build.directory}/classes" to="" />
                    </pathconvert>
                    <echo file="${project.build.directory}/classes/examples/vdm-libs-sl.index">${vdm-libs-sl}</echo>

                    <fileset id="vdm-lib-pp-set" dir="${project.build.directory}/classes/examples/libs/PP" />
                    <pathconvert pathsep="${line.separator}" property="vdm-libs-pp" refid="vdm-lib-pp-set">
                        <map from="${project.build.directory}/classes" to="" />
                    </pathconvert>
                    <echo file="${project.build.directory}/classes/examples/vdm-libs-pp.index">${vdm-libs-pp}</echo>

                    <fileset id="vdm-lib-rt-set" dir="${project.build.directory}/classes/examples/libs/RT" />
                    <pathconvert pathsep="${line.separator}" property="vdm-libs-rt" refid="vdm-lib-rt-set">
                        <map from="${project.build.directory}/classes" to="" />
                    </pathconvert>
                    <echo file="${project.build.directory}/classes/examples/vdm-libs-rt.index">${vdm-libs-rt}</echo>

                  <fileset id="vdm-example-sl-set" dir="${project.build.directory}/classes/examples/VDMSL">
                    <include name="**/*.vdmsl" />
                    <include name="**/README.txt" />
                    <exclude name="libs/**" />
                  </fileset>
                  <pathconvert pathsep="${line.separator}" property="vdm-examples-sl" refid="vdm-example-sl-set">
                    <map from="${project.build.directory}/classes" to="" />
                  </pathconvert>
                  <echo file="${project.build.directory}/classes/examples/vdm-examples-sl.index">${vdm-examples-sl}</echo>

                  <fileset id="vdm-example-pp-set" dir="${project.build.directory}/classes/examples/VDM++">
                    <include name="**/*.vdmpp" />
                    <include name="**/README.txt" />
                    <exclude name="libs/**" />
                  </fileset>
                  <pathconvert pathsep="${line.separator}" property="vdm-examples-pp" refid="vdm-example-pp-set">
                    <map from="${project.build.directory}/classes" to="" />
                  </pathconvert>
                  <echo file="${project.build.directory}/classes/examples/vdm-examples-pp.index">${vdm-examples-pp}</echo>

                  <fileset id="vdm-example-rt-set" dir="${project.build.directory}/classes/examples/VDMRT">
                    <include name="**/*.vdmrt" />
                    <include name="**/README.txt" />
                    <exclude name="libs/**" />
                  </fileset>
                  <pathconvert pathsep="${line.separator}" property="vdm-examples-rt" refid="vdm-example-rt-set">
                    <map from="${project.build.directory}/classes" to="" />
                  </pathconvert>
                  <echo file="${project.build.directory}/classes/examples/vdm-examples-rt.index">${vdm-examples-rt}</echo>

                </target>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <configuration>
          <testFailureIgnore>true</testFailureIgnore>
          <redirectTestOutputToFile>true</redirectTestOutputToFile>
          <includes>
            <include>**/*Test.java</include>
            <include>**/*Test?.java</include>
            <include>**/*TestSuite.java</include>
          </includes>
        </configuration>
      </plugin>

      <!-- never deploy/release/publish this module -->
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-deploy-plugin</artifactId>
        <configuration>
          <skip>true</skip>
        </configuration>
      </plugin>

      <!-- <plugin> -->
      <!--   <groupId>org.apache.maven.plugins</groupId> -->
      <!--   <artifactId>maven-jar-plugin</artifactId> -->
      <!--   <configuration> -->
      <!--     <includes> -->
      <!--       <include>**/*.class</include> -->
      <!--       <include>examples/**</include> -->
      <!--     </includes> -->
      <!--   </configuration> -->
      <!--   <executions> -->
      <!--     <execution> -->
      <!--       <goals> -->
      <!--         <goal>test-jar</goal> -->
      <!--       </goals> -->
      <!--     </execution> -->
      <!--   </executions> -->
      <!-- </plugin> -->
    </plugins>
    <pluginManagement>
    	<plugins>
    		<!--This plugin's configuration is used to store Eclipse m2e settings only. It has no influence on the Maven build itself.-->
    		<plugin>
    			<groupId>org.eclipse.m2e</groupId>
    			<artifactId>lifecycle-mapping</artifactId>
    			<version>1.0.0</version>
    			<configuration>
    				<lifecycleMappingMetadata>
    					<pluginExecutions>
    						<pluginExecution>
    							<pluginExecutionFilter>
    								<groupId>
    									org.apache.maven.plugins
    								</groupId>
    								<artifactId>
    									maven-antrun-plugin
    								</artifactId>
    								<versionRange>[1.7,)</versionRange>
    								<goals>
    									<goal>run</goal>
    								</goals>
    							</pluginExecutionFilter>
    							<action>
    								<ignore />
    							</action>
    						</pluginExecution>
    					</pluginExecutions>
    				</lifecycleMappingMetadata>
    			</configuration>
    		</plugin>
    	</plugins>
    </pluginManagement>
  </build>
</project>
